[build]
builder = "nixpacks"

[build.nixpacks]
# Install both Node.js and Python
providers = ["python", "node"]

# Build frontend first, then install Python deps
buildPhase = """
cd frontend && npm ci && npm run build && cd .. && \
pip install -r requirements.txt
"""

[deploy]
# Install Playwright browsers at runtime (build env differs from runtime env)
startCommand = "playwright install --with-deps chromium && cd backend && python app.py"

# Health check
healthcheckPath = "/api/health"
healthcheckTimeout = 100

# Railway will assign a port via PORT env var
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

# NOTE: Add a Railway Volume mounted at /app/data to persist the SQLite database
# Go to Railway Dashboard > Your Service > Settings > Volumes
# Mount path: /app/data
