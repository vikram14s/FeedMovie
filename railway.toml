[build]
builder = "nixpacks"

[build.nixpacks]
# Install both Node.js and Python
providers = ["python", "node"]

# Add system packages for Playwright/Chromium
aptPkgs = ["libnss3", "libatk1.0-0", "libatk-bridge2.0-0", "libcups2", "libdrm2", "libxkbcommon0", "libxcomposite1", "libxdamage1", "libxfixes3", "libxrandr2", "libgbm1", "libasound2", "libpango-1.0-0", "libcairo2", "libglib2.0-0"]

# Build frontend first, then install Python deps
buildPhase = """
cd frontend && npm ci && npm run build && cd .. && \
pip install -r requirements.txt
"""

[deploy]
# Install Playwright browsers at startup (they don't persist from build)
startCommand = "playwright install chromium && cd backend && python app.py"

# Health check
healthcheckPath = "/api/health"
healthcheckTimeout = 100

# Railway will assign a port via PORT env var
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

# NOTE: Add a Railway Volume mounted at /app/data to persist the SQLite database
# Go to Railway Dashboard > Your Service > Settings > Volumes
# Mount path: /app/data
